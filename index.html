<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An R package for providing an efficient and flexible system to solve sparse mixed model equations • LMMsolver</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="An R package for providing an efficient and flexible system to solve sparse mixed model equations">
<meta property="og:description" content="An efficient and flexible system to solve sparse mixed model
    equations, for models that are often used in statistical genetics. 
    Important applications are the use of splines to model spatial or temporal
    trends. Another application area is mixed model QTL analysis for 
    multiparental populations, allowing for heterogeneous residual variance and
    random design matrices with Identity-By-Descent (IBD) probabilities.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">LMMsolver</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="articles/index.html">Vignettes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-seedling"></span>
     
    other packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://biometris.github.io/statgenSTA">statgenSTA</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGxE">statgenGxE</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGWAS">statgenGWAS</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenHTP">statgenHTP</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenIBD">statgenIBD</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/Biometris/LMMsolver">
    <span class="fa fa-github fa-lg fab"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="lmmsolver" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#lmmsolver" class="anchor"></a>LMMsolver</h1></div>

<p>The aim of the <code>LMMsolver</code> package is to provide an efficient and flexible system to estimate variance components using restricted maximum likelihood or REML (Patterson and Thompson 1971), for models where the mixed model equations are sparse. An example of an application is using splines to model spatial (Rodríguez-Álvarez et al. 2018; Boer, Piepho, and Williams 2020) or temporal (Bustos-Korts et al. 2019) trends. Another example is mixed model Quantitative Trait Locus (QTL) analysis for multiparental populations, allowing for heterogeneous residual variance and design matrices with Identity-By-Descent (IBD) probabilities (Li et al. 2021).</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<ul>
<li>Install from CRAN:</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"LMMsolver"</span><span class="op">)</span></code></pre></div>
<ul>
<li>Install latest development version from GitHub (requires <a href="https://github.com/r-lib/remotes">remotes</a> package):</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Biometris/LMMsolver"</span>, ref <span class="op">=</span> <span class="st">"develop"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>As an example of the functionality of the package we use a model defined in Rodríguez-Álvarez et al. (2015). It uses the <code>USprecip</code> data set in the <code>spam</code> package (Furrer and Sain 2010).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">LMMsolver</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="co">## Get precipitation data from spam</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">USprecip</span>, package <span class="op">=</span> <span class="st">"spam"</span><span class="op">)</span>

<span class="co">## Only use observed data.</span>
<span class="va">USprecip</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">USprecip</span><span class="op">)</span>
<span class="va">USprecip</span> <span class="op">&lt;-</span> <span class="va">USprecip</span><span class="op">[</span><span class="va">USprecip</span><span class="op">$</span><span class="va">infill</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></code></pre></div>
<p>A two-dimensional P-spline can be defined with the <code><a href="reference/spl1D.html">spl2D()</a></code> function, with longitude and latitude as covariates. The number of segments chosen here is equal to the number of segments used in Rodríguez-Álvarez et al. (2015).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/LMMsolve.html">LMMsolve</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">anomaly</span> <span class="op">~</span> <span class="fl">1</span>,
                 spline <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="reference/spl1D.html">spl2D</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">lon</span>, x2 <span class="op">=</span> <span class="va">lat</span>, nseg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">41</span>, <span class="fl">41</span><span class="op">)</span><span class="op">)</span>,
                 data <span class="op">=</span> <span class="va">USprecip</span><span class="op">)</span></code></pre></div>
<p>The summary function gives a table with the effective dimensions and the penalty parameters:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">obj1</span><span class="op">)</span>
<span class="co">#&gt; Table with effective dimensions and penalties: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;          Term Effective Model Nominal     Ratio     Penalty</span>
<span class="co">#&gt; 1 (Intercept)    1.0000     1       1 1.0000000  0.00000000</span>
<span class="co">#&gt; 2        splF    3.0000     3       3 1.0000000  0.00000000</span>
<span class="co">#&gt; 3      s(lon)  302.6004  1936    1932 0.1566255  0.09679905</span>
<span class="co">#&gt; 4      s(lat)  409.0868  1936    1932 0.2117426  0.36223681</span>
<span class="co">#&gt; 5    residual 5190.3128  5906    5906 0.8788203 13.52577271</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Total Effective Dimension: 5906</span></code></pre></div>
<p>The spatial trend for the precipitation can now be plotted on the map of the USA.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plotDat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/obtainSmoothTrend.html">obtainSmoothTrend</a></span><span class="op">(</span><span class="va">obj1</span>, grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">300</span><span class="op">)</span>, includeIntercept <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">usa</span> <span class="op">=</span> <span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span><span class="op">(</span><span class="st">"usa"</span>, regions <span class="op">=</span> <span class="st">"main"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/point.in.polygon.html">point.in.polygon</a></span><span class="op">(</span><span class="va">plotDat</span><span class="op">$</span><span class="va">lon</span>, <span class="va">plotDat</span><span class="op">$</span><span class="va">lat</span>, <span class="va">usa</span><span class="op">$</span><span class="va">x</span>, <span class="va">usa</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
<span class="va">plotDat</span> <span class="op">&lt;-</span> <span class="va">plotDat</span><span class="op">[</span><span class="va">v</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">plotDat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span>, fill <span class="op">=</span> <span class="va">ypred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">topo.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Precipitation (anomaly) US April 1948"</span>, x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-Plot_USprecip-1.png" width="70%"></p>
<p>Further examples can be found in the vignette.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">"Solving_Linear_Mixed_Models"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Boer2020">
<p>Boer, Martin P., Hans Peter Piepho, and Emlyn R. Williams. 2020. “Linear Variance, P-splines and Neighbour Differences for Spatial Adjustment in Field Trials: How are they Related?” <em>J. Agric. Biol. Environ. Stat.</em> 25 (4). Springer: 676–98. <a href="https://doi.org/10.1007/S13253-020-00412-4" class="uri">https://doi.org/10.1007/S13253-020-00412-4</a>.</p>
</div>
<div id="ref-Bustos-Korts2019">
<p>Bustos-Korts, Daniela, Martin P. Boer, Marcos Malosetti, Scott Chapman, Karine Chenu, Bangyou Zheng, and Fred A. van Eeuwijk. 2019. “Combining Crop Growth Modeling and Statistical Genetic Modeling to Evaluate Phenotyping Strategies.” <em>Front. Plant Sci.</em> 10 (November). Frontiers Media S.A. <a href="https://doi.org/10.3389/FPLS.2019.01491/FULL" class="uri">https://doi.org/10.3389/FPLS.2019.01491/FULL</a>.</p>
</div>
<div id="ref-Furrer2010">
<p>Furrer, R, and SR Sain. 2010. “spam: A sparse matrix R package with emphasis on MCMC methods for Gaussian Markov random fields.” <em>J. Stat. Softw.</em> <a href="http://core.kmi.open.ac.uk/download/pdf/6340272.pdf" class="uri">http://core.kmi.open.ac.uk/download/pdf/6340272.pdf</a>.</p>
</div>
<div id="ref-Li2021">
<p>Li, Wenhao, Martin P. Boer, Chaozhi Zheng, Ronny V. L. Joosen, and Fred A. van Eeuwijk. 2021. “An IBD-based mixed model approach for QTL mapping in multiparental populations.” <em>Theor. Appl. Genet. 2021</em> 1 (August). Springer: 1–18. <a href="https://doi.org/10.1007/S00122-021-03919-7" class="uri">https://doi.org/10.1007/S00122-021-03919-7</a>.</p>
</div>
<div id="ref-Patterson1971">
<p>Patterson, HD, and R Thompson. 1971. “Recovery of inter-block information when block sizes are unequal.” <em>Biometrika</em>. <a href="http://biomet.oxfordjournals.org/content/58/3/545.short" class="uri">http://biomet.oxfordjournals.org/content/58/3/545.short</a>.</p>
</div>
<div id="ref-Rodriguez-Alvarez2018">
<p>Rodríguez-Álvarez, María Xosé, Martin P. Boer, Fred A. van Eeuwijk, and Paul H.C. Eilers. 2018. “Correcting for spatial heterogeneity in plant breeding experiments with P-splines.” <em>Spat. Stat.</em> 23 (March). Elsevier: 52–71. <a href="https://doi.org/10.1016/J.SPASTA.2017.10.003" class="uri">https://doi.org/10.1016/J.SPASTA.2017.10.003</a>.</p>
</div>
<div id="ref-Rodriguez-Alvarez2015">
<p>Rodríguez-Álvarez, María Xosé, Dae Jin Lee, Thomas Kneib, María Durbán, and Paul Eilers. 2015. “Fast smoothing parameter separation in multidimensional generalized P-splines: the SAP algorithm.” <em>Stat. Comput.</em> 25 (5). Kluwer Academic Publishers: 941–57. <a href="https://doi.org/10.1007/S11222-014-9464-2" class="uri">https://doi.org/10.1007/S11222-014-9464-2</a>.</p>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Martin Boer <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-1879-4588" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Bart-Jan van Rossum <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-8673-2514" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-pkg.org/pkg/LMMsolver"><img src="https://www.r-pkg.org/badges/version/LMMsolver"></a></li>
<li><a href="https://www.r-pkg.org/pkg/LMMsolver"><img src="https://cranlogs.r-pkg.org/badges/LMMsolver" alt="CRAN RStudio mirror downloads"></a></li>
<li><a href="https://github.com/Biometris/LMMsolver/actions?workflow=R-CMD-check"><img src="https://github.com/Biometris/LMMsolver/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/Biometris/LMMsolver"><img src="https://codecov.io/gh/Biometris/LMMsolver/branch/master/graph/badge.svg" alt="codecov"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Martin Boer, Bart-Jan van Rossum.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
